{% extends "base.html" %}
{% block content %}

<div class="max-w-4xl mx-auto space-y-6 fade">

    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400 font-game drop-shadow-sm flex items-center gap-3">
                <i data-lucide="edit-3" class="text-indigo-400 w-8 h-8"></i>
                Edit Quest Challenge
            </h2>
            <p class="text-slate-400 mt-1">Refine the details of this encounter.</p>
        </div>
        <a href="{{ url_for('teacher.questions') }}" class="text-slate-400 hover:text-white transition-colors flex items-center gap-2 group">
            <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
            Back to Quest Log
        </a>
    </div>

    <!-- MAIN EDITOR CARD -->
    <div class="bg-slate-800/40 backdrop-blur-md border border-white/10 rounded-2xl overflow-hidden p-6 md:p-8 shadow-2xl">
        
        <!-- EDIT FORM -->
        <form method="post" class="space-y-8">
            
            <!-- Question Prompt -->
            <div class="space-y-2">
                <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Challenge Prompt</label>
                <div class="relative">
                    <i data-lucide="message-square" class="absolute left-4 top-4 w-5 h-5 text-slate-500"></i>
                    <textarea name="prompt" required rows="3" placeholder="What is the riddle?"
                        class="w-full pl-12 pr-4 py-3 bg-slate-950/50 border border-slate-700 rounded-xl text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all placeholder-slate-600 resize-y">{{ q.prompt }}</textarea>
                </div>
            </div>

            <!-- Options Grid -->
            <div class="bg-slate-900/30 p-6 rounded-xl border border-white/5 space-y-4">
                <h3 class="text-sm font-bold text-indigo-300 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="list" class="w-4 h-4"></i> Possible Answers
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for i in range(4) %}
                    <div class="relative group">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-600 font-mono text-xs font-bold px-2 border-r border-slate-700">
                            {{ i + 1 }}
                        </span>
                        <input name="opt{{ i+1 }}" value="{{ opt_texts[i] }}" placeholder="Option {{ i+1 }}"
                            class="w-full pl-12 pr-4 py-3 bg-slate-950 border border-slate-700 rounded-lg text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all placeholder-slate-600 group-hover:border-slate-600">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Metadata Config -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Correct Answer -->
                <div class="space-y-2">
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Correct Index</label>
                    <div class="relative">
                        <i data-lucide="check-circle-2" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-emerald-500"></i>
                        <input name="correct" value="{{ q.correct_answers }}" placeholder="e.g. 1" 
                            class="w-full pl-10 pr-4 py-2 bg-slate-950 border border-slate-700 rounded-lg text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition-all">
                    </div>
                    <p class="text-xs text-slate-500 ml-1">Comma separate for multiple (e.g. 1,3)</p>
                </div>

                <!-- Difficulty -->
                <div class="space-y-2">
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Difficulty</label>
                    <div class="relative">
                        <i data-lucide="zap" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-yellow-500"></i>
                        <input name="difficulty" type="number" min="1" max="10" value="{{ q.difficulty }}" placeholder="1-10" 
                            class="w-full pl-10 pr-4 py-2 bg-slate-950 border border-slate-700 rounded-lg text-white focus:ring-2 focus:ring-yellow-500 focus:border-transparent outline-none transition-all">
                    </div>
                </div>

                <!-- Question Type -->
                <div class="space-y-2">
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Type</label>
                    <div class="relative">
                        <i data-lucide="shuffle" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-500"></i>
                        <select name="qtype" class="w-full pl-10 pr-4 py-2 bg-slate-950 border border-slate-700 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none appearance-none cursor-pointer hover:bg-slate-900 transition-colors">
                            <option value="single" {% if q.qtype == "single" %}selected{% endif %}>Single Choice</option>
                            <option value="multiple" {% if q.qtype == "multiple" %}selected{% endif %}>Multiple Choice</option>
                            <option value="reverse" {% if q.qtype == "reverse" %}selected{% endif %}>Reverse Logic</option>
                        </select>
                        <i data-lucide="chevron-down" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"></i>
                    </div>
                </div>
            </div>

            <hr class="border-white/10">

            <!-- Action Buttons -->
            <div class="flex items-center justify-between pt-2">
                <button type="submit" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-indigo-500/20 transition-all hover:scale-105 active:scale-95 flex items-center gap-2">
                    <i data-lucide="save" class="w-5 h-5"></i>
                    Save Changes
                </button>
            </div>

        </form>
    </div>

    <!-- DANGER ZONE -->
    <div class="bg-red-900/10 border border-red-500/20 rounded-xl p-6 flex flex-col md:flex-row items-center justify-between gap-4 mt-8">
        <div>
            <h4 class="text-red-400 font-bold flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                Danger Zone
            </h4>
            <p class="text-xs text-red-300/60 mt-1">Once deleted, this question cannot be recovered.</p>
        </div>
        
        <form method="post" action="{{ url_for('teacher.delete_question', qid=q.id) }}" onsubmit="return confirm('WARNING: Are you sure you want to delete this question? This action cannot be undone.');">
            <button type="submit" class="bg-red-500/10 hover:bg-red-500 hover:text-white text-red-400 border border-red-500/30 px-6 py-2 rounded-lg font-medium transition-all flex items-center gap-2">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
                Delete Question
            </button>
        </form>
    </div>

</div>

{% endblock %}